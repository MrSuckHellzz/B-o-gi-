<%- include('partials/header') %>
<main>
    <h1 class="main-title text-center m-3 color"><strong>Các nhóm hàng</strong></h1>


    <h3 id="form-button">&#x2795; Thêm nhóm hàng</h3>
    <form id="category-form" method="POST" action="/category">
        <label for="categoryName" class="form-label me-2">Tên nhóm hàng:</label>
        <input type="text" class="form-control me-2 border-black" id="categoryName" name="categoryName" required>
        <label for="categoryDescription" class="form-label me-2">Mô tả:</label>
        <textarea class="form-control me-2 border-black" id="categoryDescription" name="categoryDescription" rows="5" required></textarea>
        <label for="categoryImage" class="form-label me-2">URL hình ảnh:</label>
        <input type="text" class="form-control me-2 border-black" id="categoryImage" name="categoryImage">
        <button type="submit" class="submit-button">Thêm</button>
    </form>

    <hr>

    <div class="category-list">
        <% categories.forEach(category => { %>
            <div class="category-card">
                <a href="/product/<%= category._id %>" class="category-link">
                    <div class="category-item">
                        <div class="first-column">
                            <h3><%= category.name %></h3>
                            <% if (category.image) { %>
                                <img src="<%= category.image %>" alt="Category Image">
                            <% } else { %>
                                <img src="/placeholder.png" alt="No Image Available">
                            <% } %>
                        </div>
                        <div class="second-column">
                            <p><%= category.description %></p>
                        </div>
                    </div>
                </a>
                <div class="category-actions">
                    <form method="POST" action="/category/delete/<%= category._id %>" onsubmit="return confirm('Bạn có chắc chắn muốn xóa nhóm hàng này không?');">
                        <button type="submit" class="delete-button">&#10060; Xóa</button>
                    </form>
                    <button class="edit-button" data-bs-target="#category-fixing-<%= category._id %>" data-bs-toggle="modal" data-bs-dismiss="modal">&#9998; Sửa</button>
                    <div id="category-fixing-<%= category._id %>" class="modal fade" tabindex="-1">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title">Thay đổi nhóm hàng</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    <form method="POST" action="/category/update/<%= category._id %>">
                                        <div class="mb-3">
                                            <label for="categoryName" class="form-label">Tên nhóm hàng:</label>
                                            <input type="text" class="form-control border-black" id="categoryName" name="categoryName" value="<%= category.name %>" required>
                                        </div>
                                        <div class="mb-3">
                                            <label for="categoryDescription" class="form-label">Mô tả:</label>
                                            <textarea class="form-control border-black" id="categoryDescription" name="categoryDescription" rows="5" required><%= category.description %></textarea>
                                        </div>
                                        <div class="mb-3">
                                            <label for="categoryImage" class="form-label">URL hình ảnh:</label>
                                            <input type="text" class="form-control border-black" id="categoryImage" name="categoryImage" value="<%= category.image %>">
                                        </div>
                                        <button type="submit" class="submit-button">Lưu thay đổi</button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        <% }) %>
    </div>
</main>
<script>
    //Toggle category form visibility
    let formButton = document.getElementById('form-button');
    let categoryForm = document.getElementById('category-form');
    
    formButton.addEventListener('click', () => {
        if (categoryForm.classList.contains('visible') === false) {
            categoryForm.classList.toggle('visible');
            formButton.innerHTML ="&#x2796; Ẩn biểu mẫu";
        } else {
            categoryForm.classList.toggle('visible');
            formButton.innerHTML ="&#x2795; Thêm nhóm hàng";
        }
    });
</script>
<%- include('partials/footer') %>